const int trigPin1 = 9;
const int echoPin1 = 10;
const int trigPin2 = 11;
const int echoPin2 = 12;
const int buzzerPin = 8;
const int ledRedPin = 7;
const int ledGreenPin = 6;


const int segmentos[] = { 0 ,1 ,2 ,3 , 4}; // EU TEMHO DISPOMIVEL ESSES MA PLCA   D  E F G H 

const bool digitos[3][5] = {
  {1, 1, 1 , 1 , 1 , 1, }, 
  {0, 1,   1, 0, 0 , 0, }, 
  {1, 1,  0, 1, 1, 0,}  
};

void setup() {
  pinMode(trigPin1, OUTPUT);
  pinMode(echoPin1, INPUT);
  pinMode(trigPin2, OUTPUT);
  pinMode(echoPin2, INPUT);
  
  pinMode(buzzerPin, OUTPUT);
  pinMode(ledRedPin, OUTPUT);
  pinMode(ledGreenPin, OUTPUT);
  
  for (int i = 0; i < 5; i++) {
    pinMode(segmentos[i], OUTPUT);
  }
  
  Serial.begin(9600);
}

void mostrarNumero(int num) {
  if (num < 0 || num > 2) return; 
  for (int i = 0; i < 7; i++) {
    digitalWrite(segmentos[i], digitos[num][i] ? HIGH : LOW);
  }
}

void loop() {
  long duration1, distance1;
  long duration2, distance2;
  int vagasLivres = 2; 
  
  // Leitura do primeiro sensor ultrassônico
  digitalWrite(trigPin1, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin1, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin1, LOW);
  duration1 = pulseIn(echoPin1, HIGH);
  distance1 = (duration1 * 0.0343) / 2;

  // Leitura do segundo sensor ultrassônico
  digitalWrite(trigPin2, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin2, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin2, LOW);
  duration2 = pulseIn(echoPin2, HIGH);
  distance2 = (duration2 * 0.0343) / 2;

  // Verifica o estado da primeira vaga
  if (distance1 < 5) { // Se a distância for menor que 5 cm, a vaga está ocupada
    digitalWrite(ledRedPin, HIGH);
    digitalWrite(ledGreenPin, LOW);
    vagasLivres--; // Reduz o número de vagas livres
  } else {
    digitalWrite(ledGreenPin, HIGH);
    digitalWrite(ledRedPin, LOW);
  }

  // Verifica o estado da segunda vaga
  if (distance2 < 5) {
    digitalWrite(ledRedPin, HIGH);
    digitalWrite(ledGreenPin, LOW);
    vagasLivres--;
  } else {
    digitalWrite(ledGreenPin, HIGH);
    digitalWrite(ledRedPin, LOW);
  }

  // Mostrar o número de vagas livres no display de 7 segmentos
  if (vagasLivres >= 0 && vagasLivres <= 2) {
    mostrarNumero(vagasLivres);
  }

  // Imprime no monitor serial o número de vagas livres
  Serial.print("Vagas livres: ");
  Serial.println(vagasLivres);

  delay(1000); // Intervalo de 1 segundo entre as leituras
}
